<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Posts - Tech insights and tips</title><meta name=description content="Sharing insights, tips, and solutions that I find useful in my professional journey"><link rel=alternate type=application/rss+xml href=https://kdas.me/post/index.xml title="Tech insights and tips"><link rel=icon type=image/x-icon href=https://kdas.me/favicon.ico><link rel=apple-touch-icon-precomposed href=https://kdas.me/favicon.png><link rel=stylesheet href=https://kdas.me/css/style.min.39f94800ac05f5ec049805ca89c52fff5dc715aa3c1ba6e268fe6e2c28a3f665.css integrity="sha256-OflIAKwF9ewEmAXKicUv/13HFao8G6biaP5uLCij9mU="><script src=https://kdas.me/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js type=text/javascript integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script><meta property="og:title" content="Posts"><meta property="og:description" content="Sharing insights, tips, and solutions that I find useful in my professional journey"><meta property="og:type" content="website"><meta property="og:url" content="https://kdas.me/post/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content="Sharing insights, tips, and solutions that I find useful in my professional journey"></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><div class=header-top-left><h1 class=site-title><a href=/>Tech insights and tips</a></h1><ul class=social-icons><li><a href=https://github.com/okdas title=Github rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://twitter.com/kdasme title=Twitter rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></li><li><a href=https://kdas.me/index.xml title=RSS rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328.0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765.0 183.105.0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686.0 38.981.0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></span></a></li></ul></div><div class=header-top-right></div></div><nav><a href=https://kdas.me/ title=Notes>Notes</a>
<a href=https://kdas.me/links title=Links>Links</a></nav></header><main id=main tabindex=-1><div class=index-content></div><div class="articles h-feed"><h1 class=post-title>Posts</h1><div class="post-short-list h-entry"><div class=post-header><header><h2 class="p-name post-title"><a class=u-url href=/post/ovh-firewall-howto/>OVH Firewall HowTo</a></h2></header></div><h1 id=ovh-firewall-a-comprehensive-guide>OVH Firewall: A Comprehensive Guide
<span><a href=#ovh-firewall-a-comprehensive-guide><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h1><h2 id=introduction>Introduction
<span><a href=#introduction><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>OVH.com services offer an intriguing feature that, as of this writing, lacks official documentation: the OVH Firewall. Launched in 2014 alongside the new managerV6 (control panel), this firewall has become an integral part of OVH&rsquo;s security infrastructure.</p><h2 id=automatic-activation-during-ddos-attacks>Automatic Activation During DDoS Attacks
<span><a href=#automatic-activation-during-ddos-attacks><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>One of the most crucial aspects of the OVH Firewall is its automatic activation during Distributed Denial of Service (DDoS) attacks. Once activated, the firewall cannot be disabled until the attack subsides. This automatic response mechanism underscores the critical importance of maintaining up-to-date firewall rules. By default, no rules are set, allowing all connections to be established.</p><h2 id=important-characteristics-and-limitations>Important Characteristics and Limitations
<span><a href=#important-characteristics-and-limitations><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><h3 id=internal-network-exemption>Internal Network Exemption
<span><a href=#internal-network-exemption><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>A notable characteristic is that these firewall rules do not affect connections within the OVH network. This behavior is intentional, as the Firewall is part of OVH&rsquo;s VAC (Anti-DDoS solution), specifically the &ldquo;Firewall Network&rdquo; component in their architecture.</p><p><img src=/media/ovh-firewall-howto/vac-inside.jpg alt="VAC Architecture"></p><h3 id=rule-limit-and-priority>Rule Limit and Priority
<span><a href=#rule-limit-and-priority><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h3><p>Users should be aware of several key limitations:</p><ol><li>There is a maximum of 20 rules per firewall.</li><li>Each rule has its own priority, but the priority system is counterintuitive. <strong>Higher numbers in the priority column actually indicate lower priority in the Firewall.</strong></li><li>The firewall only blocks traffic from outside the OVH network. Internal OVH traffic can still reach your server on any port.</li></ol><p>To illustrate the priority system: if you authorize TCP port 80 on priority 18 and then refuse all connections on priority 19, traffic will still flow on port 80. This is because the higher number (19) actually has a lower priority in the firewall&rsquo;s logic. It&rsquo;s almost as if the priority numbers should be reversed, which can be very confusing for users.</p><h2 id=best-practices>Best Practices
<span><a href=#best-practices><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>For optimal security, it&rsquo;s recommended to:</p><ol><li>Deny ALL IPv4 connections by default.</li><li>Allow only necessary incoming connections (e.g., ports 80 and 443 for a web server).</li><li>Configure rules for required outgoing connections (e.g., DNS, email, system updates).</li></ol><p>Here&rsquo;s an example of a well-configured ruleset:</p><p><img src=/media/ovh-firewall-howto/rules.png alt="Firewall Rules Example"></p><p>In this configuration:</p><ul><li>Rule 19 (lowest priority) rejects ALL IPv4 traffic.</li><li>Higher priority rules allow specific necessary traffic:<ul><li>Ports 80 and 443 for HTTP and HTTPS</li><li>Outgoing TCP connections for system updates, email sending, etc. (rule #13)</li></ul></li></ul><p>For DNS, this setup utilizes OVH&rsquo;s internal nameserver (213.186.33.99), which is accessible because it&rsquo;s within the OVH network.</p><h2 id=additional-security-measures>Additional Security Measures
<span><a href=#additional-security-measures><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>It&rsquo;s crucial to understand that the OVH Firewall is not sufficient for complete server security. Since it only blocks traffic from outside the OVH network, you must implement additional security measures:</p><ol><li>Use a server-level firewall (such as UFW - Uncomplicated Firewall) to protect against internal OVH network traffic.</li><li>Secure sensitive ports like SSH (22) using the server-level firewall and other best practices (key-based authentication, non-standard ports, etc.).</li><li>Regularly update and patch your server to address potential vulnerabilities.</li></ol><h2 id=conclusion>Conclusion
<span><a href=#conclusion><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>The OVH Firewall provides robust protection against DDoS attacks and external threats, but it&rsquo;s just one layer of security. For comprehensive protection:</p><ol><li>Implement the OVH Firewall rules as described above.</li><li>Use a server-level firewall to guard against internal network threats.</li><li>Apply additional security measures for services like HTTP and SSH.</li></ol><p>Remember, security is an ongoing process. Regularly review and update your firewall rules and security practices to ensure optimal protection for your OVH-hosted services.</p><div class=post-info><div class="post-date dt-published"><a class=u-url href=/post/ovh-firewall-howto/><time datetime=2015-09-15>2015-09-15</time></a></div><a class="post-hidden-url u-url" href=https://kdas.me/post/ovh-firewall-howto/>https://kdas.me/post/ovh-firewall-howto/</a>
<a href=https://kdas.me/ class="p-name p-author post-hidden-author h-card" rel=me>Dmitry K.</a><div class=post-taxonomies><ul class=post-categories><li><a href=https://kdas.me/categories/ovh/>OVH</a></li><li><a href=https://kdas.me/categories/hosting/>hosting</a></li></ul><ul class=post-tags><li><a href=https://kdas.me/tags/ovh/>#ovh</a></li><li><a href=https://kdas.me/tags/firewall/>#firewall</a></li><li><a href=https://kdas.me/tags/vac/>#vac</a></li><li><a href=https://kdas.me/tags/ddos/>#ddos</a></li><li><a href=https://kdas.me/tags/anti-ddos/>#anti-ddos</a></li></ul></div></div></div><div class="post-short-list h-entry"><div class=post-header><header><h2 class="p-name post-title"><a class=u-url href=/post/ipset-for-iptables-huge-sets-filtering/>ipset for iptables huge sets filtering</a></h2></header></div><p>Start by installing the necessary software:
<code>apt-get install zip unzip ipset</code></p><p>Next, create a hash set:
<code>ipset create hash_block hash:net</code></p><p>To block TCP connections, use the following command:</p><p><code>iptables -I INPUT -p tcp --dport 25565 -m set --match-set sfs_block src -j DROP</code></p><p>This might be useful with proxy lists (a similar mechanism works on flyspring.net), for example, with the StopForumSpam list:</p><pre tabindex=0><code>ipset destroy temporably
ipset create hash_block hash:net
ipset create temporably hash:net
wget -N http://flyspring.net/files/listed_ip_7.zip -P /tmp
unzip /tmp/listed_ip_7.zip -d /tmp/
sed &#39;s:^:add tempset :&#39; /tmp/listed_ip_7.txt &gt; /tmp/listed_ip_7_importfile.txt
ipset restore &lt; /tmp/listed_ip_7_importfile.txt
rm /tmp/listed_ip_7_importfile.txt /tmp/listed_ip_7.txt /tmp/listed_ip_7.zip
ipset swap tempset hash_block
</code></pre><div class=post-info><div class="post-date dt-published"><a class=u-url href=/post/ipset-for-iptables-huge-sets-filtering/><time datetime=2015-08-10>2015-08-10</time></a></div><a class="post-hidden-url u-url" href=https://kdas.me/post/ipset-for-iptables-huge-sets-filtering/>https://kdas.me/post/ipset-for-iptables-huge-sets-filtering/</a>
<a href=https://kdas.me/ class="p-name p-author post-hidden-author h-card" rel=me>Dmitry K.</a><div class=post-taxonomies><ul class=post-tags><li><a href=https://kdas.me/tags/iptables/>#iptables</a></li></ul></div></div></div></div></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>© Dmitry K., 2024<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br></p></div></div><p class="h-card vcard"><a href=https://kdas.me/ class="p-name u-url url fn" rel=me>Dmitry K.</a>
/
<a class="p-email u-email email" rel=me href=mailto:okdas@pm.me>okdas@pm.me</a></p></footer></div></body></html>